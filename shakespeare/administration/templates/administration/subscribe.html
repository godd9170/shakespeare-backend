{% extends './base.html' %}
{% load static %}


{% block extrahead %}
    <script src="https://checkout.stripe.com/checkout.js"></script>
{% endblock %}

{% block content %}
<div id="willy" style="display: none;">
    <svg x="0px" y="0px" width=100 height=100 viewBox="0 0 100 100">
        <g>
            <path fillRule="evenodd" clipRule="evenodd" d="M50.687,11.019c13.995-0.156,24.723,5.948,31.052,19.02
                                c1.471,3.042,2.659,6.238,4.369,9.144c1.803,3.062,3.787,6.113,6.2,8.717c4.735,5.104,6.315,11.686,3.637,17.35
                                c-2.301,4.861-7.684,7.209-12.809,5.543c-3.761-1.219-4.214-4.29-4.472-7.555c-0.652-8.335-1.139-16.694-2.224-24.978
                                c-0.491-3.723-1.89-7.448-3.503-10.891c-5.065-10.811-13.57-15.33-25.972-14.218c-10.152,0.91-19.469,8.292-21.723,18.514
                                c-1.894,8.594-2.551,17.449-3.712,26.193c-0.152,1.146-0.052,2.325-0.056,3.488c-0.026,6.982-1.523,9.459-5.904,9.759
                                c-6.979,0.478-11.903-3.181-12.685-9.474c-0.679-5.469,1.329-9.944,5.127-13.923c2.062-2.16,3.945-4.591,5.398-7.174
                                c2.055-3.653,3.548-7.604,5.44-11.35C25.219,16.583,35.864,10.898,50.687,11.019z"/>
            <path fillRule="evenodd" clipRule="evenodd" d="M44.057,78.862c4.283,0,7.823,0,11.97,0c-1.229,2.898-2.116,5.631-3.5,8.095
                c-1.533,2.731-3.399,2.698-4.95-0.071C46.236,84.497,45.35,81.864,44.057,78.862z">
            </path>
            <path fillRule="evenodd" clipRule="evenodd" d="M39.221,70.788c2.935-1.992,5.774-4.146,8.856-5.889
                c1.078-0.61,3.076-0.759,4.091-0.18c3.14,1.795,6.005,4.041,8.839,6.016c-3.938,0.668-7.34-1.534-10.15-3.466
                c-4.156,1.513-7.907,2.877-11.657,4.24C39.207,71.269,39.213,71.029,39.221,70.788z">
                <animateTransform
                    attributeType="xml"
                    attributeName="transform"
                    type="rotate"
                    from="-45 50 68"
                    to="45 50 68"
                    dur="0.8s"
                    repeatCount="indefinite"
                />
            </path>
        </g>
    </svg>
    <h3>Creating Your Account</h3>
</div>
{% endblock %}

{% block footerjs %}
<script>
    var price = {{SHAKESPEARE_MONTHLY_PRICE}}/100;
    var handler = StripeCheckout.configure({
        key: "{{ PINAX_STRIPE_PUBLIC_KEY }}",
        image: "{% static "administration/shakespeare128.png" %}",
        name: "Shakespeare",
        description: "$" + price + "/email, {{SHAKESPEARE_BILLING_FREQUENCY}}",
        panelLabel: "Subscribe",
        allowRememberMe: false,
        token: function(resp, args){
            //show a loader
            document.getElementById("willy").style.display = "block";

            //create a basic form
            var form = document.createElement("form");
            form.method = "POST";
            form.action = "/administration/get-started/";
            form.style.display = 'none';

            //create an input for the token and add it to the form
            var stripeToken = document.createElement("input"); 
            stripeToken.value=resp.id;
            stripeToken.name="stripeToken";
            form.appendChild(stripeToken);

            //create an input for the email and add it to the form
            var email = document.createElement("input"); 
            email.value=resp.email;
            email.name="email";
            form.appendChild(email);

            //submit the form
            document.body.appendChild(form);
            form.submit();

        }
    });

    window.onload = function(e) {
      handler.open();
      e.preventDefault();
    };
</script>
{% endblock %}